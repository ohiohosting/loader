-- Roblox Highlight ESP
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInput = game:GetService("UserInputService")

-- Table to store highlights per player
local highlights = {}

-- Creates and configures a Highlight for a given character
local function addHighlight(player)
    if highlights[player] then return end
    local character = player.Character
    if not character or not character:FindFirstChild("HumanoidRootPart") then return end

    local h = Instance.new("Highlight")
    h.Name = "ESPHighlight"
    h.Adornee = character
    h.FillColor = Color3.new(1, 0, 0)           -- red fill
    h.OutlineColor = Color3.new(1, 1, 1)        -- white outline
    h.FillTransparency = 0.5
    h.OutlineTransparency = 0
    h.Parent = character

    highlights[player] = h
end

-- Removes the Highlight when character is removed or player leaves
local function removeHighlight(player)
    local h = highlights[player]
    if h and h.Parent then
        h:Destroy()
    end
    highlights[player] = nil
end

-- Hook up events for a player
local function trackPlayer(player)
    -- when character spawns
    player.CharacterAdded:Connect(function(char)
        wait(0.1)
        addHighlight(player)
    end)
    -- when character is removed
    player.CharacterRemoving:Connect(function()
        removeHighlight(player)
    end)
    -- if character already exists
    if player.Character then
        addHighlight(player)
    end
end

-- Initialize for existing players
for _, player in ipairs(Players:GetPlayers()) do
    trackPlayer(player)
end

-- Track future players
Players.PlayerAdded:Connect(trackPlayer)
Players.PlayerRemoving:Connect(removeHighlight)

-- Toggle ESP on/off with
